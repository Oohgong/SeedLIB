<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.seed.lib.member.MemberMapper">

 	<select id="getIdCheck" parameterType="MemberVO" resultType="String">
	
		SELECT COUNT(USERNAME) FROM MEMBER WHERE USERNAME = #{userName} and PASSWORD = #{password}
	
 
	</select>
	
	<insert id="setMemberRole" parameterType="MemberVO">
	
	INSERT INTO MEMBER_ROLE VALUES (#{userName},
			(SELECT ROLENUM  FROM ROLE WHERE ROLENAME =ROLE_MEMBER)
		) 
	</insert>
	
	
	

		<insert id="setJoin" parameterType="MemberVO">
		INSERT INTO MEMBER (USERNAME, PASSWORD, NAME, GENDER, EMAIL, BIRTH, PHONE, POST, ADDRESS1, ADDRESS2, REGDATE, ENABLED, LOANSTATUS, OVMYRCOUNT, DROPSTATUS)
		VALUES ( #{userName}, #{password}, #{name},#{gender}, #{email}, #{birth}, #{phone}, #{post}, #{address1}, #{address2},now(), 0, 0, 0, 0)
		</insert> 

			  <select id="getLogin" parameterType="MemberVO" resultMap="getLoginResult">
			
				SELECT M.*, R.*
					FROM MEMBER M
					  INNER JOIN
					  MEMBER_ROLE MR
					  ON M.USERNAME = MR.USERNAME
					  INNER JOIN
					  ROLE R 
					  ON MR.ROLENUM =R.ROLENUM
					  WHERE M.USERNAME= #{userName} AND M.PASSWORD=#{password}
					  
			</select>
					  
		<resultMap type="MemberVO" id="getLoginResult">
		<id column="username" property="userName" />
		<result column="name" property="name"/>
		<result column="gender" property="gender"/>		
		<result column="birth" property="birth"/>
		<result column="email" property="email"/>
		<result column="phone" property="phone"/>
		<result column="post" property="post"/>
		<result column="address1" property="address1"/>
		<result column="address2" property="address2"/>
		<result column="regdate" property="regDate"/>
		<result column="enabled" property="enabled"/>
		<result column="loanstatus" property="loanStatus"/>
		<result column="ovmyrcount" property="ovMyrCount"/>
		<result column="dropstatus" property="dropStatus"/>
		<collection property="roleVOs" javaType="List" ofType="RoleVO">
			<result column="roleName" property="roleName"/>
		</collection>
		</resultMap>
		
		
		
		
		
</mapper>    